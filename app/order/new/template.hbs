<Layout 
  @aside={{help}}>
  {{#with (changeset model.order OrderValidations ) as |changesetObj|}} 
    <h1>Amount: {{remainder }}</h1>
    <McForm
      @heading="Create a new order"
      @role="Add this order"
      @didPerform={{action "createNewOrder" changesetObj}}
      @didDecline={{action "cancel" changesetObj}}
      @isSaving={{isSaving}}>
      <div class="mc-divider">Order Details</div>
      <div class="form-group">
        <div class="inline field">
          <label for="company name">Order Date 
            <span class="required m-l-5" >*</span> 
          </label>
          <FormFields::Input
            @placeholder="Select the order date"
            @changeset={{changesetObj}}
            @property="order_date"
            @classNames="figures"
            @didValidate={{action "validate" changesetObj}}
            @type="date"
          />
        </div>
        <div class="ui right labeled input inline field">
          <label for="company name">Amount 
            <span class="required m-l-5" >*</span> 
          </label>
          <FormFields::Amount
            @placeholder="Amount"
            @changeObj={{changesetObj}}
            @property="amount"
            @classNames=""
            @didValidate={{action "validate" changesetObj}}
            @options={{currency}}
          />
        </div>
        <div class="ui right labeled input inline field">
          <label for="company name">Profit 
            <span class="required m-l-5" >*</span> 
          </label>
          <FormFields::Amount
            @placeholder="Amount"
            @changeObj={{changesetObj}}
            @property="profit"
            @classNames=""
            @didValidate={{action "validate" changesetObj}}
            @options={{currency}}
          />
        </div>
        <div class="inline field">
          <label for="Compnany Type">Customer
            <span class="required m-l-5">*</span>
          </label>
          <FormFields::Dropdown 
            @options={{model.types}}
            @changeset={{changesetObj}}
            @property="customer_id"
            @classNames="text-right"
          />
        </div> 
        <div class="inline field">
          <label for="Compnany Type">Account Manager
            <span class="required m-l-5">*</span>
          </label>
          <FormFields::Dropdown 
            @options={{model.managers}}
            @changeset={{changesetObj}}
            @property="account_manager_id"
            @classNames="text-right"
          />
        </div> 
      </div>
      <div class="mc-divider">
        <div class="inline-flex">
          Business Units 
          <span class="required m-l-5">*</span>
          <Forms::Popup />
        </div>
      </div>
      <div class="form-group">
        <EmbeddedFormWrapper
          @left="Business Unit"
          @right="Amount"
          @classNames="m-l-20"
        >
        {{#each businessUnitOrders as |b_order|}}
        <h1> {{b_order.amount}} </h1>
          {{#with (changeset b_order BusinessUnitValidation) as |b_orderChangeset|}}
          <h1>{{get b_orderChangeset amount}}</h1>
          <EmbeddedForm 
            @currency={{currency}}
            @property="amount"
            @changesetObj={{b_orderChangeset}}
            @validate={{action "validate" b_orderChangeset}}
          />
          {{/with}}
        {{/each}}
        </EmbeddedFormWrapper>
        <div role="button" class="" {{action "addBusinessUnit"}}>
          {{svg-jar "plus" width="10px" height="10px" }} Add New 
        </div>
      </div>
      <div class="mc-divider">
        Manufacturers
        <span class="required">*</span>
        <span role="button" class="action m-l-40" {{action "addBusinessUnit"}}>
          {{svg-jar "plus-2" width="13px" height="13px" }} New Manufacturer
        </span>
      </div>
      <div class="form-group">
        <EmbeddedFormWrapper
          @left="Manufacturer"
          @right="Amount"
        >
        {{#each manufacturer-orders as |m-order|}}
          {{#with (changeset m-order) as |m-orderChangeset|}}
            <EmbeddedForm
              @property="manufacturer"
              @currency={{currency}}
              @changeObj={{m-orderChangeset}}
              @validate={{action "validate" m-orderChangeset}}
            />
            {{/with}}
          {{/each}}
        </EmbeddedFormWrapper>
        <div role="button" class="" {{action "addBusinessUnit"}}>
          {{svg-jar "plus" width="10px" height="10px" }} Add New 
        </div>
      </div>
      <div class="mc-divider">Oder description <span class="faint" >( what is the order about? )</span> </div>
      <div class="form-group">
        <div class="">
          <FormFields::Textarea
            @columns=""
            @rows={{5}}
            @property="description"
            @changeset={{changesetObj}}
            @placeholder="Enter the description"
          />
        </div>
      </div>
    </McForm>
  {{/with}}
</Layout>
